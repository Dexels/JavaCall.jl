<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JavaCall.jl -- Call Java from Julia</title>

    <link rel="stylesheet" href="res/styles.css">
    <link rel="stylesheet" href="res/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <style TYPE="text/css">
      code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
    </style>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [['$','$'], ['\\(','\\)']],
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'header'] // removed 'code' entry
          }
      });
      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i = 0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
    </script>  
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>JavaCall.jl</h1>
        <p>Call Java Programs from Julia </p>

        <ul>
          <li><a href="https://github.com/aviks/JavaCall.jl/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/aviks/JavaCall.jl/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/aviks/JavaCall.jl">View On <strong>GitHub</strong></a></li>
        </ul>
        <div class="menu">
        <ul >
           <li><a href="index.html">Home</a></li>
           <li><a href="types.html">Types</a></li>
           <li><a href="methods.html">Methods</a></li>
           <li><a href="gc.html">GC</a></li>
           <li><a href="faq.html">Troubleshooting and FAQs</a></li>
        </ul>
      </div>
      </header>
      <section>
	<h1 id="lifecycle-and-api">Lifecycle and API</h1>

<h2 id="loading">Loading</h2>

<p>When the module is first loaded, via <code>using</code> or <code>load</code>, it searches for the JVM dynamic library, <code>libjvm.so|libjvm.dylib|jvm.dll</code>. The search is dependent on the <code>JAVA_HOME</code> environment variable, which must be set, except on OSX, where the <code>/usr/libexec/java_home</code> command is used to infer it. In case the library is not found, the module load fails, and no further functionality is available. </p>

<p>If the JVM library is now found even when it legitimately exists, a workaround is to set the <code>JAVA_LIB</code> environment variable to the path to library file. However, a better option will be a pull request updating the library search code. </p>

<p>Currently, as a debugging aid, the module will print the location of the jvm library when it loads. </p>

<h2 id="initialisation">Initialisation</h2>

<p>The <code>JavaCall.init(args::Array{String, 1})</code> method must to used to load and initialise the Java Virtual Machine before any other functions in this module can be called. The <code>args</code> parameter is an array containing JVM initialisation arguments. This can be used to set, for example, the system classpath, and the maximum Java heap. Any valid commandline argument to the <code>java</code> command can be used. Unrecognised arguments are silently discarded. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">JavaCall</span><span class="o">.</span><span class="n">init</span><span class="p">([</span><span class="s">&quot;-Xmx512M&quot;</span><span class="p">,</span> <span class="s">&quot;-Djava.class.path=</span><span class="si">$</span><span class="s">(joinpath(Pkg.dir(), &quot;</span><span class="n">JavaCall</span><span class="s">&quot;, &quot;</span><span class="n">test</span><span class="s">&quot;))&quot;</span><span class="p">,</span> <span class="s">&quot;-verbose:jni&quot;</span><span class="p">,</span> <span class="s">&quot;-verbose:gc&quot;</span><span class="p">])</span>
</code></pre></div>
<p>Note that only one JVM can be initialised within a process. Hence, the <code>init</code> function can be called only once per process. </p>

<h2 id="referencing-types">Referencing types</h2>

<p>As described in the [types][types.html] section, the @jimport macro returns the Julia type that corresponds to the relevant Java class. This Julia type can the be used a proxy for the Java type, and can be used for instantiating objects of that class, or calling static methods on it. <br>
<code>julia<br>
jlm = @jimport &quot;java.lang.Math&quot;<br>
jnu = @jimport java.net.URL<br>
</code><br>
The syntax for importing inner classes is slightly different. <br>
<code>java<br>
package myPackage;<br>
public class Outer {<br>
    public class Inner{<br>
      public void innerMethod() {<br>
        System.out.println(&quot;In Inner class Method&quot;);<br>
      }<br>
    }l<br>
    public Inner createrInnerObject() {<br>
      Inner innerObj=new Inner();<br>
      return innerObj;<br>
  }<br>
}<br>
</code><br>
To import the outer and inner clasess, one would use <code>Outer$Inner</code> instead of <code>Outer.Inner</code>. <br>
<code>julia<br>
jouter=@jimport myPackage.Outer<br>
jinner=@jimport myPackage.Outer$Inner<br>
</code></p>

<h2 id="calling-static-methods">Calling Static Methods</h2>

<p>The primary interface to Java methods is the <code>jcall</code> function. Like the inbuilt Julia <code>ccall</code> function, you need to supply the return type, a tuple of the argument types, and the method arguments themselves. The first argument to jcall however is the receiver of the method in Java. In case of static methods therefore, the receiver is the Julia type corresponding to the Java class that holds the method. </p>

<p>Arguments are converted if possible to the specified types, via the usual Julia <code>convert</code> function. This includes converting <code>JavaObject</code> instances referencing a particular java class, to a <code>JavaObject</code> referencing its superclass. This allows some measure of the polymorphism inherent in Java methods. Strings are automatically converted, and hence Julia strings may be passed directly into <code>jcall</code>. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">jcall</span><span class="p">(</span><span class="n">jlm</span><span class="p">,</span> <span class="s">&quot;sin&quot;</span><span class="p">,</span> <span class="n">jdouble</span><span class="p">,</span> <span class="p">(</span><span class="n">jdouble</span><span class="p">,),</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c">#1.0</span>
</code></pre></div>
<h2 id="initialising-objects-via-constructors">Initialising Objects via Constructors</h2>

<p>Each of the Julia <code>JavaObject</code> types contain a constructor that looks much like the <code>jcall</code> function. You provide a tuple of argument types, and the arguments themselves, and it return an instance of <code>JavaObject</code> that wraps a Java object of the corresponding class. Unlike <code>jcall</code> however, in this case the receiver and the return type is implicit, and does not need to specified. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">gurl</span> <span class="o">=</span> <span class="n">jnu</span><span class="p">((</span><span class="n">JString</span><span class="p">,),</span> <span class="s">&quot;http://www.google.com&quot;</span><span class="p">)</span>
<span class="n">outerObj</span><span class="o">=</span> <span class="n">jouter</span><span class="p">((),)</span>
</code></pre></div>
<h2 id="calling-instance-methods">Calling Instance Methods</h2>

<p>Calling instance methods uses the <code>jcall</code> function, with an instance of the <code>JavaObject</code> type as the receiver. As before, the method takes as arguments the return type, the tuple of the argument types, and the arguments themselves. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">jcall</span><span class="p">(</span><span class="n">gurl</span><span class="p">,</span> <span class="s">&quot;getHost&quot;</span><span class="p">,</span> <span class="n">JString</span><span class="p">,())</span> <span class="c">#&quot;wwww.google.com&quot;</span>
<span class="n">innerObj</span><span class="o">=</span><span class="n">jcall</span><span class="p">(</span><span class="n">outerObj</span><span class="p">,</span> <span class="s">&quot;createrInnerObject&quot;</span><span class="p">,</span> <span class="n">jinner</span><span class="p">,())</span>
<span class="n">jcall</span><span class="p">(</span><span class="n">innerObj</span><span class="p">,</span> <span class="s">&quot;innerMethod&quot;</span><span class="p">,</span> <span class="n">Void</span><span class="p">,())</span> <span class="c">#Prints &quot;In Inner class Method&quot;</span>
</code></pre></div>
<h2 id="calling-array-methods">Calling Array Methods</h2>

<p>Java arrays are referenced as Julia <code>Arrays</code> of the relevant (aliased) Java types. Hence a Java <code>int[]</code> is <code>Array{jint, 1}</code> in Julia. And similar for all other primitive types. All arrays of non-primitive Java objects are <code>Array{JavaObject{T}, 1}</code> in Julia, where <code>T</code> is the name of the relevant Java class. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">j_u_arrays</span> <span class="o">=</span> <span class="p">@</span><span class="n">jimport</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Arrays</span>
<span class="n">jcall</span><span class="p">(</span><span class="n">j_u_arrays</span><span class="p">,</span> <span class="s">&quot;binarySearch&quot;</span><span class="p">,</span> <span class="n">jint</span><span class="p">,</span> <span class="p">(</span><span class="n">Array</span><span class="p">{</span><span class="n">jint</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="n">jint</span><span class="p">),</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">jcall</span><span class="p">(</span><span class="n">j_u_arrays</span><span class="p">,</span> <span class="s">&quot;binarySearch&quot;</span><span class="p">,</span> <span class="n">jint</span><span class="p">,</span> <span class="p">(</span><span class="n">Array</span><span class="p">{</span><span class="n">JavaObject</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="n">JavaObject</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="s">&quot;abc&quot;</span><span class="p">,</span><span class="s">&quot;uvw&quot;</span><span class="p">,</span><span class="s">&quot;xyz&quot;</span><span class="p">],</span> <span class="s">&quot;uvw&quot;</span><span class="p">)</span>
<span class="n">jcall</span><span class="p">(</span><span class="n">j_u_arrays</span><span class="p">,</span> <span class="s">&quot;copyOf&quot;</span><span class="p">,</span> <span class="n">Array</span><span class="p">{</span><span class="n">jint</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="n">Array</span><span class="p">{</span><span class="n">jint</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="n">jint</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">jcall</span><span class="p">(</span><span class="n">j_u_arrays</span><span class="p">,</span> <span class="s">&quot;copyOf&quot;</span><span class="p">,</span> <span class="n">Array</span><span class="p">{</span><span class="n">JObject</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="n">Array</span><span class="p">{</span><span class="n">JavaObject</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="n">jint</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="s">&quot;c&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<p>As noted in the introduction, only one dimensional arrays are currently supported. </p>
<div class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">s</span><span class="o">=</span><span class="n">JString</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</code></pre></div>
<p>When a Java string is returned from a method call, it can be converted to a Julia string using the <code>bytestring(s::JString)</code> function. </p>

<h1 id="unload">Unload</h1>

<p>The <code>JavaCall.destroy</code> command will unload the JVM, destryoing all its references. Note however that even after calling destroy, a new JVM cannot be initialised in the same process. Initialising a JVM is a completely one way process. </p>

      </section>
      <footer>
        <p></p>
        <p><small>This project is maintained by <a href="http://www.sengupta.net/musings/">Avik Sengupta</a>. <br /> Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="res/scale.fix.js"></script>
    <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37085988-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
  </body>
</html>
